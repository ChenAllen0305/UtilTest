# 总体设计
### 代码组织结构
- 在站端EMS-V2.0.0基础上进行迭代，以支持微电网相关需求，定义项目版本为EMS-V2.1.0
- 前端发布配置中，可以分别发布工商业储能和微电网两类产品，不同产品包含不同模块
### 后台结构设计
- 新增ems-microgrid服务，包含如下内容：
  - 微网单元维护
  - 电源设备维护
  - 负荷设备维护
  - 该服务依赖ems-device服务
- 电站模型
  - 电站类型枚举中，新增：微电网（Microgrid）
  - 本次迭代的电站类型，选择“微电网”
- 能量单元类型枚举
  - 新增用能单元，发电单元和其他单元类型
- 台账管理维护
```
┌── 光伏单元
├── 储能单元
├── 用能单元
│   ├── 用电设备 //设备大类
│   │    └── 空调 //设备类型
│   └── 辅助设备
│        └── 开关
├── 发电单元
│   ├── 发电设备
│   │    └── 燃机
│   └── 辅助设备
│        └── 开关
└── 其他单元
    └── 调度终端
```
- 用能单元类型（LoadUnti）
  - 新增用能单元分类，与储能单元、光伏单元等能量单元同级
  - 用能单元下新增设备大类：用电设备（utilization）
  - 用电设备下新增设备类型：具体设备类型待定
  
- 发电单元类型（GenerationUnit）
  
  - 新增发电单元分类，与储能单元、光伏单元等能量单元同级
  - 发电单元下新增设备大类：发电设备（generation）
  - 发电设备下新增设备类型：燃机（gasTurbine）
  
- 其他单元类型（OtherUnit）

  - 新增其他单元分类，与储能单元、光伏单元等能量单元同级
  - 其他单元下具体设备大类和设备类型待定
- 微网单元（MicrogridUnit）
  - 新增微网单元管理功能，用于维护微网单元
  - 1个电站下可以有多个微网单元
  - 新增微网单元时，可以从系统中选择微网单元包含哪些单元（如光伏单元、储能单元、用能单元、发电单元等）
  
- 电源设备（PowerDevice）
  
  - 微网单元下的所有光伏单元、储能单元和发电设备都属于电源设备
  
- 负荷设备（LoadDevice）
  
  - 微网单元下的所有用电设备都属于负荷设备
  
- Neo4j数据库设计
  - Neo4j节点：用能单元（LoadUnit）
    - ```
      LoadUnit = {
        id: Long, //自增ID
        name: String, //业务主键
        title: String //标题
      }
      ```
  - Neo4j节点：发电单元（GenerationUnit）
    - ```
      GenerationUnit = {
        id: Long, //自增ID
        name: String, //业务主键
        title: String //标题
      }
      ```
  - Neo4j节点：其他单元（OtherUnit）
    - ```
      OtherUnit = {
        id: Long, //自增ID
        name: String, //业务主键
        title: String //标题
      }
      ```
  - Neo4j节点：微网单元（MicrogridUnit）
    ```
      MicrogridUnit = {
        id: Long, //自增ID
        name: String, //业务主键
        title: String, //标题
        activity: Boolean //是否可用
      }
    ```
  - Neo4j节点：电源设备（PowerDevice）
    ```
      PowerDevice = {
        id: Long, //自增ID
        name: String, //业务主键
        title: String, //标题
        device: Device, //电源对应的设备
        deviceType: String, //设备类型标题
        ratedPower: Double, //额定功率（单位为kW）
        capacity: Double, //容量/建设规模（单位为kWh或kWp）
        category: PowerCategory, //电源分类
        level: Integer, //电源等级
        maintenanceStatus: Integer //检修状态
      }
    ```
  - Neo4j节点：负荷设备（LoadDevice）
    ```
      LoadDevice = {
        id: Long, //自增ID
        name: String, //业务主键
        title: String, //标题
        alias: String, //别名
        controlSequence: Integer, //控制轮次
        powerRating: Double, //功率定值（单位kW）
        controlPeriod: List<LoadControlPeriod>, //控制时段
        level: Integer //保电级别
      }
    ```
  - Neo4j节点：控制时段（LoadControlPeriod）
    ```
      LoadControlPeriod = {
        id: Long, //自增ID
        startTime: Time, //开始时间
        endTime: Time //结束时间
      }
    ```
  - Neo4j节点：电源分类（PowerCategory）
    - ```
      PowerCategory extends StatusType = {
      }
      
      StatusType = {
        id: Long, //自增ID
        name: String, //业务主键
        title: String, //标题
        sn: Long, //排序字段
        activity: Boolean //是否可用
      }
      ```
    - 系统默认枚举
      ```
      [{
        name: "mainPower"
        title: "主电源"
        sn: 1,
        activity: true
      },{
        name: "standbyPower"
        title: "备用电源"
        sn: 2,
        activity: true
      }]
      ```
  - Neo4j节点：检修状态（MaintenanceStatus）
    - ```
      MaintenanceStatus extends StatusType = {
      }
      
      StatusType = {
        id: Long, //自增ID
        name: String, //业务主键
        title: String, //标题
        sn: Long, //排序字段
        activity: Boolean //是否可用
      }
      ```
    - 系统默认枚举
      ```
      [{
        name: "none"
        title: "无"
        sn: 1,
        activity: true
      },{
        name: "toBeProgress"
        title: "待检修"
        sn: 2,
        activity: true
      },{
        name: "inProgress"
        title: "检修中"
        sn: 3,
        activity: true
      }]
      ```
  - Neo4j节点：电站运行方式（StationWorkMode）
    - ```
      StationWorkMode extends StatusType = {
      }
      
      StatusType = {
        id: Long, //自增ID
        name: String, //业务主键
        title: String, //标题
        sn: Long, //排序字段
        activity: Boolean //是否可用
      }
      ```
    - 系统默认枚举
      ```
      [{
        name: "offGrid"
        title: "离网型"
        sn: 1,
        activity: true
      },{
        name: "gridConnected"
        title: "并网型"
        sn: 2,
        activity: true
      }]
      ```
  - 关系设计
    ```
    (s:Station)-[:HAS_MICROGRIDUNIT]->(mu:MicrogridUnit); //电站和微网单位的关系
    (mu:MicrogridUnit)-[:CONTAINS]->(eu:EnergyUnit); //微网单位和能量单元的关系
    (mu:MicrogridUnit)-[:HAS_POWERDEVICE]->(pd:PowerDevice); //微网单位和电源设备的关系
    (mu:MicrogridUnit)-[:HAS_LOADDEVICE]->(pd:LoadDevice); //微网单位和负荷设备的关系
    (eu:EnergyUnit)-[:CONTAINS]->(d:Device); //能量单元和设备的关系
    (pd:PowerDevice)-[:DEVICE_OF]->(d:Device); //电源设备和设备的关系
    (pd:PowerDevice)-[:ENERGYUNIT_OF]->(eu:EnergyUnit); //电源设备和能量单元的关系
    (pd:PowerDevice)-[:POWERCATEGORY_OF]->(pc:PowerCategory); //电源设备和电源分类的关系
    (pd:PowerDevice)-[:MAINTENANCESTATUS_OF]->(ms:MaintenanceStatus); //电源设备和检修状态的关系
    (ld:LoadDevice)-[:DEVICE_OF]->(d:Device); //负荷设备和设备的关系
    (ld:LoadDevice)-[:BREAKER_OF]->(d:Device); //负荷设备和控制开关的关系
    (ld:LoadDevice)-[:CONTROLPERIOD_OF]->(lcp:LoadControlPeriod); //负荷设备和控制时段的关系
    //TODO 各单元与设备大类的关系，以及设备大类和设备类型的关系
    ```
  - 电站模型
    - 增加系统默认属性：运行方式（workMode）
    - 运行方式下拉枚举：枚举项StationWorkMode
- Mysql数据库设计
  - 计划检修：
  
| 表名：电源计划检修表 | data_power_maintenance_plan | | | |
|:-|:-|:-|:-|:-|
| 字段名 | 字段描述 | 字段类型 | 默认值 | 说明 |
| id | 主键 | bigint | 自增长 | 必填 |
| power_device_id | 电源ID | bigint |  | 必填 |
| start_time_plan | 计划开始时间 | Date |  | 必填 |
| end_time_plan | 计划结束时间 | Date |  | 必填 |
| desc | 检修内容描述 | varchar(512) |  |  |
| influence | 影响功率/容量 | decimal(18,3) |  |  |
| start_time_real | 实际开始时间 | Date |  |  |
| end_time_real | 实际结束时间 | Date |  |  |

- 触发逻辑设计
  - 自动新增电源设备和负荷设备
    - 微网单元绑定光伏单元、储能单元和发电设备时，自动新增电源设备
    - 微网单元绑定用能单元时，自动新增负荷设备
  - 发电设备电量计算
    - 电量计算定时任务中，增加发电设备的电量计算：通过电能示数计算15分钟、日、月、年的电量
- 其他说明
  
  - 本次迭代，设备台账相关页面不做变动，模型由后台手动添加和维护
# 功能设计
### 首页
- 安全运行天数
  
  - 安全运行天数 =  当前系统时间（后台时间） - 电站投运时间（电站台账属性）
  - 电站投运时间获取（电站ID如果获取不到，则传递-1，后台判断ID为-1时，获取默认电站）
    ```
    POST http://192.168.2.142:8080/gateway
    {
    	"service":"user-auth.station.get",
    	data:{
    		"id": xxx
    	}
    }
    results = {
      id: Long, // 电站ID
      title: String, //电站标题
      ...
      productionTime: String, //投运时间字符串
      ...
    }
    ```
  
- 微网状态
  
  - 发电总功率
    - 所有发电设备功率+能量单元放电功率（如光伏的发电功率，储能的放电功率，如果储能处于充电状态，则记为0）
  - 状态显示（V2.1.0先写死成：孤岛运行）
    - 判断电站关口开关状态（遥信点号值）：=1，并网；=0：孤岛运行；1->0：并网转孤岛（已到0，但黑启动未完成）；0->1：孤岛转并网（还未到1，但并网指令为1）
    - 黑启动进度
      - 电站关口开关从1->0，但黑启动逻辑未完成（黑启动进度不为100%）
    - 同期进度
      - 并网指令已发，但关口状态仍为0
- 微网单元
  - 根据条件获得微网单元
     ```
     
     POST http://192.168.2.142:8080/gateway
     {
     	"service":"microgrid.microgridUnits.get",
     	data:{
     		"stationId": xx
     	}
     }
     results: [{
        "id": Long, //自增ID
        "name": String, //业务主键
        "title": String, //标题
        "deviceId": Long, //电源对应的设备Id
        "deviceITitle": String, //电源对应的设备标题
        "deviceTypeId": Long, //设备类型Id
        "deviceTypeTitle": String, //设备类型标题
        "microgridUnitId": Long, //所属微网单元Id
        "microgridUnitTitle": String, //所属微网单元标题
        "ratedPower": Double, //额定功率（单位为kW）
        "capacity": Double, //容量/建设规模（单位为kWh或kWp）
        "categoryId": Long, //电源分类Id
        "categoryTitle": Long, //电源分类标题
        "level": Integer //电源等级
     }]
     ```
  
- 电源状态
  - 获得所有电源设备
     ```
     
     POST http://192.168.2.142:8080/gateway
     {
     	"service":"microgrid.powerDevices.get",
     	data:{
     	}
     }
     results: [{
        "id": Long, //自增ID
        "name": String, //业务主键
        "title": String, //标题
        "deviceId": Long, //电源对应的设备Id
        "deviceITitle": String, //电源对应的设备标题
        "deviceTypeId": Long, //设备类型Id
        "deviceTypeTitle": String, //设备类型标题
        "microgridUnitId": Long, //所属微网单元Id
        "microgridUnitTitle": String, //所属微网单元标题
        "ratedPower": Double, //额定功率（单位为kW）
        "capacity": Double, //容量/建设规模（单位为kWh或kWp）
        "categoryId": Long, //电源分类Id
        "categoryTitle": Long, //电源分类标题
        "level": Integer //电源等级
     }]
     ```
   - 通过点号获得在线状态和功率实时值Websocket
    - ```
      Websocket 
      /measurements/realtime?pointNumbers=xxx,xxx
      ```
    - PointDataType
      - 在线状态：WorkStatus
      - 功率：ActivePower
  
- 异常告警
  
  - 按原API调用（略）
  
- 分布式电源出力
  - 获得所有电源设备
  - 根据电源对应的设备ID+功率点号数据类型，获得功率点号
    - deviceId = PowerDevice.device.id
    - pointDataType = ActivePower
  - 点号获得历史量测曲线
    - 获取历史量测曲线
    ```
    Websocket 
    /measurements/pointNumbers=xxx,xxx&&startDate=xxx
    ```
    - 如果某个电源没有曲线数据，则不显示（即：仅显示当天在线过的分布式电源出力情况）
  
- 电量统计
  - 获得所有电源设备（不含储能）
    ```
     POST http://192.168.2.142:8080/gateway
    {
    	"service":"microgrid.powerDevices.get",
    	data:{
    		"containsStorage": false
    	}
    }
    results: [{
       "id": Long, //自增ID
       "name": String, //业务主键
       "title": String, //标题
       "deviceId": Long, //电源对应的设备Id
       "deviceITitle": String, //电源对应的设备标题
       "deviceTypeId": Long, //设备类型Id
       "deviceTypeTitle": String, //设备类型标题
       "microgridUnitId": Long, //所属微网单元Id
       "microgridUnitTitle": String, //所属微网单元标题
       "ratedPower": Double, //额定功率（单位为kW）
       "capacity": Double, //容量/建设规模（单位为kWh或kWp）
       "categoryId": Long, //电源分类Id
       "categoryTitle": Long, //电源分类标题
       "level": Integer //电源等级
    }]
    ```
  - 根据电源对应的设备ID+点号数据类型获得发电量
    ```
     POST http://192.168.2.142:8080/gateway
    {
    	"service":"electric.electricity.batch.
    	get",
    	"data":{
    	"deviceIds":70,
    	"dtime":["2020-08-27 00:00:00","2020-08-28 00:00:00"],
    	"typeName":"Generation",
    	timeType:1
    	}
    }
    results: [{
        deviceId: Long, //设备对象
        dtime: Date, //时间
        val: Double, //发电量
        timeType: Integer, //时间维度，1-日，2-月，3-年，4-15分钟
        strategyId: String, //策略名称
        solarVal: Double, //光伏充电量
        gridVal: Double //电网充电量
    }]
    ```
  - 用电量=发电量-上网电量+从电网用电量
    - 发电量：见上一条描述
    - 上网电量（售电量）：根据电站ID和+点号数据类型（EnergyExport）
    - 从电网用电量（购电量）：根据电站ID和+点号数据类型（EnergyImport）
### 电源管理
- 获取所有电源列表
     ```
     POST http://192.168.2.142:8080/gateway
     {
     	"service":"microgrid.powerDevices.get",
     	data:{
     		"microGridUnitId": xx
     	}
     }
     results: [{
        "id": Long, //自增ID
        "name": String, //业务主键
        "title": String, //标题
        "deviceId": Long, //电源对应的设备Id
        "deviceITitle": String, //电源对应的设备标题
        "deviceTypeId": Long, //设备类型Id
        "deviceTypeTitle": String, //设备类型标题
        "microgridUnitId": Long, //所属微网单元Id
        "microgridUnitTitle": String, //所属微网单元标题
        "ratedPower": Double, //额定功率（单位为kW）
        "capacity": Double, //容量/建设规模（单位为kWh或kWp）
        "categoryId": Long, //电源分类Id
        "categoryTitle": Long, //电源分类标题
        "level": Integer //电源等级
     }]
     ```
- 获取单个电源详情
     ```
     POST http://192.168.2.142:8080/gateway
     {
     	"service":"microgrid.powerDevices.get",
     	data:{
     		"id": xx
     	}
     }
     ```
- 修改电源分类、电源等级
  - ```
    POST http://192.168.2.142:8080/gateway
    {
    	"service":"microgrid.powerDevices.patch",
    	data:{
    		"id": xx,
    		"categoryId": xx,
    		"level": xx
    	}
    }
    ```
  - 后台逻辑：修改电源等级时，需要获取到所属微网单元中所有电源设备，对电源设备进行等级重新排序（只重新排序被影响的等级），然后批量更新（包括自身），伪代码实现如下：
    ```
    // 修改后的电源等级
    Integer level;
    // 要修改电源等级的电源设备ID
    Long powerDeviceId;
    // 获取到所属微网单元中的所有电源设备，按电源等级升序排序
    List<PowerDevice> list = getPowerDevicesSortByLevelAsc(microgridUnitId);
    // 循环列表，添加需要批量更新的对象
    List<PowerDevice> updateList;
    // 用currentLevel表示每次循环完后，当前要插入的等级
    Integer currentLevel = level;
    for (item in list) {
        // 如果是自身，直接设置等级
        if (item.id == powerDeviceId) {
            item.level = level;
            updateList.add(item);
        // 只有电源等级等于要插入的等级，才会被影响
        } else if (item.level = currentLevel) {
            // 等级自增1，作为下一次循环要插入的等级
            currentLevel = ++item.level;
            updateList.add(item);
        }
    }
    // 最后批量更新
    update(updateList);
    ```
- 电源挂牌
  - ```
    POST http://192.168.2.142:8080/gateway
    {
    	"service":"microgrid.powerDevices.
    	maintenanceStart.post",
    	data:{
    		"id": xx,
    		"dtime": xx
    	}
    }
    ```
    
  - 后台逻辑
    - 更新检修状态maintenanceStatus = 检修中（inProgress）
    - 更新实际开始时间startTimeReal=dtime
- 电源摘牌
  - ```
    POST http://192.168.2.142:8080/gateway
    {
    	"service":"microgrid.powerDevices.
    	maintenanceFinish.post",
    	data:{
    		"id": xx,
    		"dtime": xx
    	}
    }
    ```
  - 后台逻辑
    - 更新检修状态maintenanceStatus = 无（none）
    - 更新实际开始时间endTimeReal=dtime
- 检修计划
  
  - 检修计划查询
    -  ```
        POST http://192.168.2.142:8080/gateway
        {
        	"service":"microgrid.powerDevices.
        	maintenancePlan.get",
        	data:{
        		"id": xx
        	}
        }
        results: [{
            id: Long, //自增ID
            powerDeviceId: Long, //电源设备ID
          startTimePlan: String, //计划开始时间：yyyy-MM-dd hh:mm:ss
          endTimePlan: String, //计划结束时间
          desc: String, //检修内容描述
          influence: Double, //影响功率/容量
          startTimeReal: String, //实际开始时间
          endTimeReal: String, //实际结束时间
      }]
      ```
    - 页面显示逻辑：不显示计划检修结束时间在系统当前时间（后台获取）之前的且挂牌时间为空的记录
  - 检修计划新增
    ```
    POST /ems-microgrid/powerDevices/{powerDeviceId}/maintenancePlan
    POST http://192.168.2.142:8080/gateway
    {
    	"service":"microgrid.powerDevices.
    	maintenancePlan.post",
    	data:{
        	"powerDeviceId": Long, //电源设备ID
        	"startTimePlan": String, //计划开始时间：yyyy-MM-dd hh:mm:ss
        	"endTimePlan": String, //计划结束时间
        	"desc": String, //检修内容描述
        	"influence": Double, //影响功率/容量
        	"startTimeReal": String, //实际开始时间
        	"endTimeReal": String, //实际结束时间
    	}
    }
    
    ```
  - 检修计划删除
    ```
    DELETE /ems-microgrid/powerDevices/{powerDeviceId}/maintenancePlan/{id}
    POST http://192.168.2.142:8080/gateway
    {
    	"service":"microgrid.powerDevices.
    	maintenancePlan.delete",
    	data:{
    		"id": xx
    	}
    }
    ```
  - 检修计划修改
    ```
    POST http://192.168.2.142:8080/gateway
    {
    	"service":"microgrid.powerDevices.
    	maintenancePlan.put",
    	data:{
        	"powerDeviceId": Long, //电源设备ID
        	"startTimePlan": String, //计划开始时间：yyyy-MM-dd hh:mm:ss
        	"endTimePlan": String, //计划结束时间
        	"desc": String, //检修内容描述
        	"influence": Double, //影响功率/容量
        	"startTimeReal": String, //实际开始时间
        	"endTimeReal": String, //实际结束时间
    	}
    }
    ```

### 负荷管理
- 查询所有负荷设备
  ```
  POST http://192.168.2.142:8080/gateway
  {
  	"service":"microgrid.loadDevices.get",
  	data:{
  	}
  }
  results: [{
      id: Long, //自增ID
      name: String, //业务主键
      title: String, //标题
      alias: String, //别名
      device: Device, //负荷对应的设备（开关）
      controlSequence: Integer, //控制轮次
      powerRating: Double, //功率定值（单位kW）
      controlPeriod: List<LoadControlPeriod>, //控制时段
      microgridUnit: MicrogridUnit, //所属微网单元，取title属性用于显示
      level: Integer //保电级别
  }]
  ```
- 查询单个负荷设备
  ```
  GET /ems-microgrid/loadDevices/{id}
  POST http://192.168.2.142:8080/gateway
  {
  	"service":"microgrid.loadDevices.get",
  	data:{
  		"id": xx
  	}
  }
  ```
- 修改负荷设备基础信息
  ```
  POST http://192.168.2.142:8080/gateway
  {
  	"service":"microgrid.loadDevices.patch",
  	data:{
  		"id": xx,
  		"title": xx,
  		"level": xx
  	}
  }
  ```
- 修改负荷设备控制信息
  ```
  POST http://192.168.2.142:8080/gateway
  {
  	"service":"microgrid.loadDevices.patch",
  	data:{
  		"id": xx,
  		"controlSequence": xx,
  		"powerRating": xx,
  		"controlPeriod": xxx// 
  		controlPeriod开始结束时间间以逗号间隔，多条记录间以分号间隔，示例：08:00,10:00;12:00,16:00
  	}
  }
  ```

### 统计报表字段修改
- 查询报表
  - 根据电站类型判断是否需要“电源累计电量”字段：如果是“微电网”则显示该字段
  - 电源累计电量字段定义（与陈帝沟通讨论）

### 视频监控列表
- Neo4j数据库设计
  - Neo4j节点：监控设备（Camera）
      ```
      Camera = {
        id: Long, //自增ID
        name: String, //业务主键
        title: String, //标题
        url: String, //视频URL路径
        brand: CameraBrand, //摄像头品牌
        sn: Long, //排序字段
        activity: Boolean //是否可用
      }
      ```
  - Neo4j节点：摄像头品牌（CameraBrand）
      ```
      CameraBrand extends StatusType = {
      }
      
      StatusType = {
        id: Long, //自增ID
        name: String, //业务主键
        title: String, //标题
        sn: Long, //排序字段
        activity: Boolean //是否可用
      }
      ```
  
- 监控设备查询
    ```
    POST http://192.168.2.142:8080/gateway
    {
    	"service":"device.cameras.get",
    	data:{
    	}
    }
    results: [{
        id: Long, //自增ID
        name: String, //业务主键
        title: String, //标题
        url: String, //视频URL路径
        brand: CameraBrand, //摄像头品牌，取title属性用于显示
        sn: Long, //排序字段
        activity: Boolean //是否可用
    }]
    ```
- 监控设备新增
    ```
    POST http://192.168.2.142:8080/gateway
    {
    	"service":"device.cameras.post",
    	data:{
        	"name": String, //业务主键
        	"title": String, //标题
        	"url": String, //视频URL路径
        	"brand": CameraBrand, //摄像头品牌，取title属性用于显示
    	}
    }
    
    ```
- 监控设备删除
    ```
    POST http://192.168.2.142:8080/gateway
    {
    	"service":"device.cameras.delete",
    	data:{
    		"id": xx
    	}
    }
    ```
- 监控设备修改
    ```
    POST http://192.168.2.142:8080/gateway
    {
    	"service":"device.cameras.put",
    	data:{
        	"id": Long, //自增ID
        	"name": String, //业务主键
        	"title": String, //标题
        	"url": String, //视频URL路径
        	"brand": {id: Long}, //摄像头品牌，取title属性用于显示
        	"sn": Long, //排序字段
        	"activity": Boolean //是否可用
    	}
    }
    ```
    ```
    PATCH /ems-device/cameras/{id}?name=xxx&&title=xxx&&url=xxx&&brandId=xxx
    POST http://192.168.2.142:8080/gateway
    {
    	"service":"device.cameras.patch",
    	data:{
        	"id": Long, //自增ID
        	"name": String, //业务主键
        	"title": String, //标题
        	"url": String, //视频URL路径
        	"brandId": Long, //摄像头品牌枚举ID
    	}
    }
    ```

### 控制策略（待定）

- 根据条件查询能量单元

  | title    | name       |
  | -------- | ---------- |
  | 光伏     | Solar      |
  | 储能     | Storage    |
  | 发电单元 | Generation |
  | 用能单元 | Load       |

  ```
  {
      "service": "device.energyUnits.get",
      "data": {
          "stationId": 770,
          "deviceTypeId": 122,
          "energyUnitTypeId": 355,
          "energyUnitTypeName": null,
          "activity": true,
          "hasAccessory": true,
          "pageParam": {
              "page": 1,
              "size": 10,
              "sort": [
                  "sn"
              ]
          }
      }
  }
  返回结果：
  {
      "results": [
          {
              "id": null,
              "name": null,
              "title": null,
              "ratedPower": null,
              "scale": null,
              "remark": null,
              "hasTransformer": null,
              "activity": null,
              "plannedProductionTime": null,
              "plannedProductionMillisecond": null,
              "productionTime": null,
              "productionMillisecond": null,
              "sn": null,
              "type": null,
              "energyUnitType": null,
              "properties": null
          }
      ],
      "page": 1,
      "size": 10,
      "totalCount": null,
      "totalPages": null,
      "errorCode": 0,
      "errorMsg": null,
      "error": false
  }
  ```

  

- 根据条件查询设备

  | title    | name       |
  | ------------ | ------------------------ |
  | 关口开关     | GatewayBreaker           |
  | 双绕组变压器 | DoubleWindingTransformer |
  | 储能PCS      | PCS                      |
  | 开关         | Breaker                  |
  | 三绕组变压器 | ThreeWindingTransformer  |
  | 火电机组     | ThermalPower             |
  | 电池单元     | BatteryUnit              |
  | 电池簇/组/串 | BatteryCluster           |
  | 电池包       | Pack                     |
  | 单体电池     | Cell                     |
  | 储能室       | EnergyStorageRoom        |
  | 集装箱       | Container                |
  | 逆变器       | Inverter                 |
  | 光伏变压器   | SolarTransformer         |
  | 燃机         | GasTurbine               |
  | 空调         | AirConditioner           |

  ```
  {
      "service": "device.devices.get",
      "data": {
          "firmId": 32,
          "stationId": 806,
          "stationTypeId": 414,
          "stationTypeName": null,
          "energyUnitId": 811,
          "deviceId": 129,
          "activity": true,
          "deviceTypeId": 345,
          "deviceTypeName": null,
          "deviceCategoryId": 373,
          "title": null,
          "production": true,
          "pageParam": {
              "page": 1,
              "size": 10,
              "sort": [
                  "sn"
              ]
          }
      }
  }
  返回结果：
  {
      "results": [
          {
              "id": null,
              "title": null,
              "deviceId": null,
              "typeId": null,
              "typeName": null,
              "pointNumber": null,
              "transformRatio": 1.0,
              "sn": null,
              "terminalId": null,
              "signalTitle": null,
              "formula": null,
              "calcPosition": null,
              "typeTitle": null,
              "terminalTitle": null,
              "terminalName": null,
              "needStorage": null
          }
      ],
      "page": 1,
      "size": 10,
      "totalCount": null,
      "totalPages": null,
      "errorCode": 0,
      "errorMsg": null,
      "error": false
  }
  ```

  


- 根据设备、类型查询点号
  | title    | name       |
  | ------------ | ------------------------ |
  | 有功功率类型     | ActivePower           |
  | 无功功率类型 | ReactivePower |


  ```
  {
      "service": "device.analogs.byDevAndType.get",
      "data": {
          "devId": "1,2,3",
          "typeId": "1,2,3",
          "terminalName": null,
          "typeName": "1,2,3"
      }
  }
  返回结果：
  {
      "results": [
          {
              "id": null,
              "title": null,
              "deviceId": null,
              "typeId": null,
              "typeName": null,
              "pointNumber": null,
              "transformRatio": 1.0,
              "sn": null,
              "terminalId": null,
              "signalTitle": null,
              "formula": null,
              "calcPosition": null,
              "typeTitle": null,
              "terminalTitle": null,
              "terminalName": null,
              "needStorage": null
          }
      ],
      "page": 1,
      "size": 10,
      "totalCount": null,
      "totalPages": null,
      "errorCode": 0,
      "errorMsg": null,
      "error": false
  }
  ```

- 根据点号批量查询量测历史值

  ```
  {
    "service":"measurement.measurements.batch.get",
    "data":{
      "pointNumbers":[10001000000226,10001000000227],
      "dtime":["2020-08-01 00:00:00","2020-08-20 00:00:00"]
    }
  }
  
  返回结果：
  {
    "results": [
      [
          {
            "pointNumber": "10001000000226",
            "dtime": "2020-08-01 00:00:00",
            "val": 0
          },
         {
           "pointNumber": "10001000000226",
           "dtime": "2020-08-01 01:00:00",
           "val": 0
         },
         ...
      ],
      [
          {
            "pointNumber": "10001000000227",
            "dtime": "2020-08-01 00:00:00",
            "val": 0
          },
         {
           "pointNumber": "10001000000227",
           "dtime": "2020-08-01 01:00:00",
           "val": 0
         },
         ...
      ]
    ],
    "page": 1,
    "size": 0,
    "totalCount": 0,
    "totalPages": 1,
    "errorCode": 0,
    "errorMsg": null
  }
  ```

  
